# 实时面部重建

> 首先需要了解**参数化人脸模型**和**blendshape**模型两个概念。

## 参数化人脸模型

> 在Blanz的方法中，他们扫描200张成年人的人头模型，每个模型包含大约70000个顶点。经过PCA处理，制作成参数化人脸模型，每张人脸模型的拓扑结构相同，只是顶点位置或颜色有所差异。你可以把各个特征向量看作是人脸不同的特征，比如脸的长短，胖瘦等。

- 这里人脸模型分成两个向量：

```
形状：$S = (X_1, Y_1, Z_1, X_2, ..., Y_n, Z_n)^T \in R^{3n}$

纹理：$T = (R_1, G_1, B_1, R_2, ..., G_n, B_n)^T \in R^{3n}$
```

- 因此任意新的一个人脸都可由这些特征向量线性组合生成：

```
$S = \bar S + \sum_{i=1}^{m}a_iS_i ;  T = \bar T + \sum_{i=1}^{m}b_iT_i\sum_{i=1}^{m}a_i = \sum_{i=1}^{m}b_i = 1 $
```

## blendshape表情模型

> blendshape是3d软件里用来做模型形变的一种技术，通过调整权重，设计师可以将目标模型变化成一系列预定义的模型，或者这些模型的任意线形组合。

- 在数字制作行业，通常用blendshape来制作表情，即用一组脸部基本表情合成新表情。同样，这些模型的拓扑结构一致，改变的只是顶点位置。为了不出现崩坏扭曲的表情，对权重做限制。

```
$ B = \sum_{i=0}^{m}w_iB_i ;  \sum_i^n w_i= 1 $
```

- 在人脸重建时，通常会使用delta blendshape，即各个表情与正常表情的差值。

```
$ B = B_0 + \sum_{i=1}^mw_i(B_i - B_0) = B_0 + \sum_{i=1}^mw_iD_i $
```

- 将blendshape和参数人脸模型结合起来就有：

```
$S = \bar S + \sum_{i=1}^{m}a_iS_i + \sum_{i=1}^mw_iD_i $

S表示一张有着某人脸特征和某表情的脸部模型。
```



## 重建

> 根据给定图像来“估计”人脸模型，有点像渲染的逆过程。因此，除了人脸模型，还得考虑相机参数。

- 这里采用弱透视投影。

- 弱透视投影使用与正交投影相同的原则，但乘以一个缩放参数来实现近大远小的效果。可看作透视投影和正交投影的混合体

> 重建算法的关键在于找出合适的参数 \{s, R, t, \vec a, \vec b, \vec w \} ，使三维人脸模型在平面的投影尽可能接近原图像。如果不考虑纹理，问题可简化为“使人脸模型关键点在平面上的投影与2d人脸关键点的位置尽可能接近”。


## 人脸检测边缘点

### 凸包算法

> 用凸包算法求出边缘线，也可以根据法线与视线夹角，求出脸部切线。或者参考[5]中描述，在一组预先保存的脸部线条上求出最外侧的点。

- 通过以上描述，我们已经将重建问题转为最优化问题。

```
$ E = \sum_{i=0}^n ||(sRS + t)_{i_{3d}} - Y_{i_{2d}}||_2^2 $

其中， S 是人脸模型，s 是缩放尺度，R 是旋转矩阵， t 是位移，Y 是人脸检测点，n 为人脸关键点个数。i_{2d} 和 i_{3d} 分别是人脸图像关键点及人脸三维模型点的索引。
```

> 由于投影变化存在，这是个非线性最小二乘问题。可以用Gauss-Newton ，Levenberg-Marquardt等算法求解，这里不展开讲。

### Other算法

- 先利用2d与3d点集估计出模型的相机参数，带入上式转为线性问题。然后分阶段求出人脸参数和表情参数。整个迭代过程都是固定一部分参数，更新其他参数。

> 人脸形状特征参数和表情参数都需要控制在一定范围内（视模型而定），不然可能会出现不合理的人脸模型。在视频场景中，还需要考虑帧间稳定性以及前后人脸特征一致等问题。


